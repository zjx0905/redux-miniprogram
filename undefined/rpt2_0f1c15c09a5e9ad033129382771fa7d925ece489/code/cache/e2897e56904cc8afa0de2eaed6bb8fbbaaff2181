{"code":"import { useState, useDispatch } from '../api/hooks';\r\nimport diff from '../utils/diff';\r\nimport isEmptyObject from '../utils/isEmptyObject';\r\nimport verifyPlainObject from '../utils/verifyPlainObject';\r\nimport serializeCopy from '../utils/serializeCopy';\r\nimport createCommit from './createCommit';\r\nimport batchUpdate from './batchUpdate';\r\nimport proxyConnectStore from './proxyConnectStore';\r\nimport mixinInitData from './mixinInitData';\r\nimport mixinLifetimes from './mixinLifetimes';\r\nconst mapStateToPropsDefault = () => ({});\r\nconst mapDispatchToPropsDefault = (dispatch) => ({ dispatch });\r\nexport default function connect(type, mapStateToProps = mapStateToPropsDefault, mapDispatchToProps = mapDispatchToPropsDefault) {\r\n    return function connected(options) {\r\n        const commit = createCommit();\r\n        const instances = [];\r\n        const { state = {}, pureState = {} } = mapStateToProps(useState());\r\n        verifyPlainObject('mapStateToProps() state', state);\r\n        verifyPlainObject('mapStateToProps() pureState', pureState);\r\n        const copyState = serializeCopy(state);\r\n        const dispatch = mapDispatchToProps(useDispatch());\r\n        verifyPlainObject('mapDispatchToProps()', dispatch);\r\n        // eslint-disable-next-line @typescript-eslint/ban-types\r\n        let unsubscribe;\r\n        function updater(rootState) {\r\n            commit.run(() => {\r\n                const { state: nextState, pureState: nextPureState } = mapStateToProps(rootState);\r\n                if (nextPureState !== void 0) {\r\n                    Object.assign(pureState, nextPureState);\r\n                }\r\n                if (nextState === void 0) {\r\n                    return;\r\n                }\r\n                const updateState = diff(state, nextState);\r\n                if (isEmptyObject(updateState)) {\r\n                    return;\r\n                }\r\n                Object.assign(state, nextState);\r\n                // eslint-disable-next-line @typescript-eslint/ban-types\r\n                instances.forEach((instance) => instance.setData(updateState));\r\n            });\r\n        }\r\n        function load() {\r\n            instances.push(this);\r\n            proxyConnectStore(this, commit, state, pureState, copyState, dispatch);\r\n            if (unsubscribe === void 0) {\r\n                unsubscribe = batchUpdate.subscribe(updater);\r\n            }\r\n        }\r\n        function unload() {\r\n            const index = instances.indexOf(this);\r\n            instances.splice(index, 1);\r\n            if (instances.length === 0 && unsubscribe !== void 0) {\r\n                unsubscribe();\r\n                unsubscribe = void 0;\r\n            }\r\n        }\r\n        return mixinLifetimes(type, mixinInitData(options, copyState), load, unload);\r\n    };\r\n}\r\n//# sourceMappingURL=index.js.map","references":["/Users/fluff/Documents/zjx0905/redux-miniprogram/src/types.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/api/hooks.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/utils/diff.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/utils/isEmptyObject.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/utils/verifyPlainObject.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/utils/serializeCopy.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/connect/createCommit.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/connect/batchUpdate.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/connect/proxyConnectStore.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/connect/mixinInitData.ts","/Users/fluff/Documents/zjx0905/redux-miniprogram/src/connect/mixinLifetimes.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/connect/index.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/fluff/Documents/zjx0905/redux-miniprogram/types/connect/index.d.ts","writeByteOrderMark":false,"text":"import { MapStateToProps, MapDispatchToProps, ConnectType } from '../types';\r\nexport default function connect(type: ConnectType, mapStateToProps?: MapStateToProps, mapDispatchToProps?: MapDispatchToProps): (options: AnyObject) => AnyObject;\r\n"}}
